<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Models - Tennis Prediction API</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Space Grotesk', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-950 via-purple-950 to-slate-950 text-slate-100 min-h-screen">
    <!-- Header -->
    <header class="bg-slate-900/80 border-b border-purple-800/50 sticky top-0 z-50 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <span class="text-2xl">üîÆ</span>
                <h1 class="text-xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                    Tennis Prediction API
                </h1>
            </div>
            <nav class="flex items-center gap-6">
                <a href="/ui/dashboard" class="text-slate-400 hover:text-slate-200 transition-colors">Dashboard</a>
                <a href="/ui/predict" class="text-slate-400 hover:text-slate-200 transition-colors">Predict</a>
                <a href="/ui/predictions" class="text-slate-400 hover:text-slate-200 transition-colors">Predictions</a>
                <a href="/ui/backtest" class="text-slate-400 hover:text-slate-200 transition-colors">Backtest</a>
                <a href="/ui/models" class="text-purple-400 font-medium">Models</a>
            </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <div class="mb-8 flex items-center justify-between">
            <div>
                <h2 class="text-3xl font-bold mb-2">‚öôÔ∏è Prediction Models</h2>
                <p class="text-slate-500">Manage and compare prediction model configurations</p>
            </div>
            <button onclick="document.getElementById('createModelModal').classList.remove('hidden')"
                    class="bg-purple-600 hover:bg-purple-500 text-white font-medium rounded-lg px-4 py-2 transition-colors flex items-center gap-2">
                ‚ûï Create Custom Model
            </button>
        </div>

        <!-- Success/Error Messages -->
        <div th:if="${param.success}" class="mb-6 p-4 rounded-xl bg-emerald-900/30 border border-emerald-500/30">
            <span th:if="${param.success[0] == 'created'}">‚úì Model created successfully!</span>
            <span th:if="${param.success[0] == 'deleted'}">‚úì Model deleted successfully!</span>
        </div>
        <div th:if="${param.error}" class="mb-6 p-4 rounded-xl bg-red-900/30 border border-red-500/30">
            ‚ö†Ô∏è <span th:text="${param.error[0]}">Error</span>
        </div>

        <!-- Model Cards -->
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div th:each="model : ${models}" 
                 class="bg-slate-900/50 border rounded-xl p-6 relative"
                 th:classappend="${model.modelId == activeModel.modelId} ? 'border-purple-500 ring-2 ring-purple-500/20' : 'border-purple-800/30'">
                
                <!-- Active Badge -->
                <div th:if="${model.modelId == activeModel.modelId}" 
                     class="absolute top-4 right-4 bg-purple-500 text-white text-xs font-medium px-2 py-1 rounded">
                    ACTIVE
                </div>

                <h3 class="text-xl font-semibold mb-2" th:text="${model.name}">Model Name</h3>
                <p class="text-slate-400 text-sm mb-4" th:text="${model.description}">Description</p>
                
                <div class="text-xs text-slate-500 mono mb-4">ID: <span th:text="${model.modelId}">id</span></div>

                <!-- Weights -->
                <div class="space-y-2 mb-6">
                    <div th:each="weight : ${model.weights}" class="flex items-center gap-2">
                        <div class="w-24 text-xs text-slate-400" th:text="${weight.key}">factor</div>
                        <div class="flex-1 h-2 bg-slate-700 rounded-full overflow-hidden">
                            <div class="h-full bg-purple-500 rounded-full" 
                                 th:style="'width: ' + ${weight.value * 100} + '%'"></div>
                        </div>
                        <div class="w-10 text-xs mono text-slate-400 text-right" 
                             th:text="${#numbers.formatDecimal(weight.value * 100, 0, 0) + '%'}">20%</div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex gap-2">
                    <form th:unless="${model.modelId == activeModel.modelId}" method="post" action="/ui/models/activate" class="flex-1">
                        <input type="hidden" name="modelId" th:value="${model.modelId}">
                        <button type="submit" class="w-full bg-purple-600 hover:bg-purple-500 text-white text-sm font-medium rounded-lg px-3 py-2 transition-colors">
                            Set Active
                        </button>
                    </form>
                    <a th:href="@{/ui/backtest(modelId=${model.modelId})}" 
                       class="flex-1 bg-slate-700 hover:bg-slate-600 text-white text-sm font-medium rounded-lg px-3 py-2 transition-colors text-center">
                        Backtest
                    </a>
                </div>
                
                <!-- Delete button for custom models -->
                <form th:if="${model.modelId.startsWith('custom-')}" method="post" action="/ui/models/delete" class="mt-2"
                      onsubmit="return confirm('Are you sure you want to delete this model?')">
                    <input type="hidden" name="modelId" th:value="${model.modelId}">
                    <button type="submit" class="w-full bg-red-900/50 hover:bg-red-800/50 text-red-400 text-sm font-medium rounded-lg px-3 py-2 transition-colors border border-red-800/30">
                        üóëÔ∏è Delete Model
                    </button>
                </form>
            </div>
        </div>

        <!-- Factor Explanation -->
        <div class="mt-12 bg-slate-900/50 border border-purple-800/30 rounded-xl p-6">
            <h3 class="text-xl font-semibold mb-4">üìñ Factor Explanations</h3>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <div>
                    <div class="text-purple-400 font-medium mb-1">Ranking</div>
                    <p class="text-sm text-slate-400">Based on current ATP/WTA world ranking. Higher ranked players score better.</p>
                </div>
                <div>
                    <div class="text-purple-400 font-medium mb-1">H2H (Head-to-Head)</div>
                    <p class="text-sm text-slate-400">Historical record between the two players. Considers all previous meetings.</p>
                </div>
                <div>
                    <div class="text-purple-400 font-medium mb-1">Recent Form</div>
                    <p class="text-sm text-slate-400">Win rate in recent matches (last 10), with more recent matches weighted higher.</p>
                </div>
                <div>
                    <div class="text-purple-400 font-medium mb-1">Surface Form</div>
                    <p class="text-sm text-slate-400">Win rate on the specific surface (hard, clay, grass) of the match.</p>
                </div>
                <div>
                    <div class="text-purple-400 font-medium mb-1">Fatigue</div>
                    <p class="text-sm text-slate-400">Number of matches played in the last 14 days. More matches = more fatigue.</p>
                </div>
                <div>
                    <div class="text-purple-400 font-medium mb-1">Momentum</div>
                    <p class="text-sm text-slate-400">Current winning/losing streak. Players on a winning streak get a boost.</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Create Model Modal -->
    <div id="createModelModal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-slate-900 border border-purple-800/50 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-purple-800/30">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold text-purple-400">‚ûï Create Custom Model</h3>
                    <button onclick="document.getElementById('createModelModal').classList.add('hidden')"
                            class="text-slate-400 hover:text-slate-200 text-2xl">&times;</button>
                </div>
                <p class="text-sm text-slate-500 mt-1">Configure weights for each prediction factor (will be normalized to 100%)</p>
            </div>
            
            <form method="post" action="/ui/models/create" class="p-6">
                <!-- Model Info -->
                <div class="mb-6 space-y-4">
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Model Name *</label>
                        <input type="text" name="name" required placeholder="My Custom Model"
                               class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm text-slate-400 mb-1">Description</label>
                        <input type="text" name="description" placeholder="Brief description of your model strategy"
                               class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>
                </div>
                
                <!-- Factor Weights -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold text-slate-300">Factor Weights</h4>
                        <div class="text-sm text-slate-400">
                            Total: <span id="totalWeight" class="mono text-purple-400">0</span>%
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <!-- Ranking -->
                        <div class="flex items-center gap-4">
                            <div class="w-40 text-sm text-slate-400">Ranking</div>
                            <input type="range" name="ranking" min="0" max="50" value="10" 
                                   class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500"
                                   oninput="updateSlider(this, 'rankingVal'); updateTotal()">
                            <div class="w-12 text-right mono text-sm"><span id="rankingVal">10</span>%</div>
                        </div>
                        
                        <!-- H2H -->
                        <div class="flex items-center gap-4">
                            <div class="w-40 text-sm text-slate-400">H2H (Head-to-Head)</div>
                            <input type="range" name="h2h" min="0" max="50" value="10" 
                                   class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500"
                                   oninput="updateSlider(this, 'h2hVal'); updateTotal()">
                            <div class="w-12 text-right mono text-sm"><span id="h2hVal">10</span>%</div>
                        </div>
                        
                        <!-- Recent Form -->
                        <div class="flex items-center gap-4">
                            <div class="w-40 text-sm text-slate-400">Recent Form</div>
                            <input type="range" name="recentForm" min="0" max="50" value="15" 
                                   class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500"
                                   oninput="updateSlider(this, 'recentFormVal'); updateTotal()">
                            <div class="w-12 text-right mono text-sm"><span id="recentFormVal">15</span>%</div>
                        </div>
                        
                        <!-- Surface Form -->
                        <div class="flex items-center gap-4">
                            <div class="w-40 text-sm text-slate-400">Surface Form</div>
                            <input type="range" name="surfaceForm" min="0" max="50" value="10" 
                                   class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500"
                                   oninput="updateSlider(this, 'surfaceFormVal'); updateTotal()">
                            <div class="w-12 text-right mono text-sm"><span id="surfaceFormVal">10</span>%</div>
                        </div>
                        
                        <!-- Fatigue -->
                        <div class="flex items-center gap-4">
                            <div class="w-40 text-sm text-slate-400">Fatigue</div>
                            <input type="range" name="fatigue" min="0" max="50" value="5" 
                                   class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500"
                                   oninput="updateSlider(this, 'fatigueVal'); updateTotal()">
                            <div class="w-12 text-right mono text-sm"><span id="fatigueVal">5</span>%</div>
                        </div>
                        
                        <!-- Momentum -->
                        <div class="flex items-center gap-4">
                            <div class="w-40 text-sm text-slate-400">Momentum (Streak)</div>
                            <input type="range" name="momentum" min="0" max="50" value="5" 
                                   class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500"
                                   oninput="updateSlider(this, 'momentumVal'); updateTotal()">
                            <div class="w-12 text-right mono text-sm"><span id="momentumVal">5</span>%</div>
                        </div>
                        
                        <!-- OAPS -->
                        <div class="flex items-center gap-4">
                            <div class="w-40 text-sm text-slate-400">OAPS (Odds-Adjusted)</div>
                            <input type="range" name="oaps" min="0" max="50" value="15" 
                                   class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500"
                                   oninput="updateSlider(this, 'oapsVal'); updateTotal()">
                            <div class="w-12 text-right mono text-sm"><span id="oapsVal">15</span>%</div>
                        </div>
                        
                        <!-- OWL Rating -->
                        <div class="flex items-center gap-4">
                            <div class="w-40 text-sm text-slate-400">OWL Rating</div>
                            <input type="range" name="owlRating" min="0" max="50" value="15" 
                                   class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500"
                                   oninput="updateSlider(this, 'owlRatingVal'); updateTotal()">
                            <div class="w-12 text-right mono text-sm"><span id="owlRatingVal">15</span>%</div>
                        </div>
                        
                        <!-- OWL Momentum -->
                        <div class="flex items-center gap-4">
                            <div class="w-40 text-sm text-slate-400">OWL Momentum</div>
                            <input type="range" name="owlMomentum" min="0" max="50" value="15" 
                                   class="flex-1 h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500"
                                   oninput="updateSlider(this, 'owlMomentumVal'); updateTotal()">
                            <div class="w-12 text-right mono text-sm"><span id="owlMomentumVal">15</span>%</div>
                        </div>
                    </div>
                </div>
                
                <!-- Submit -->
                <div class="flex gap-3">
                    <button type="button" onclick="document.getElementById('createModelModal').classList.add('hidden')"
                            class="flex-1 bg-slate-700 hover:bg-slate-600 text-white font-medium rounded-lg px-4 py-3 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 bg-purple-600 hover:bg-purple-500 text-white font-medium rounded-lg px-4 py-3 transition-colors">
                        ‚ú® Create Model
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        function updateSlider(slider, spanId) {
            document.getElementById(spanId).textContent = slider.value;
        }
        
        function updateTotal() {
            const sliders = ['ranking', 'h2h', 'recentForm', 'surfaceForm', 'fatigue', 'momentum', 'oaps', 'owlRating', 'owlMomentum'];
            let total = 0;
            sliders.forEach(name => {
                total += parseInt(document.querySelector(`input[name="${name}"]`).value);
            });
            document.getElementById('totalWeight').textContent = total;
            
            // Color coding
            const totalEl = document.getElementById('totalWeight');
            if (total === 100) {
                totalEl.className = 'mono text-emerald-400';
            } else if (total > 100) {
                totalEl.className = 'mono text-red-400';
            } else {
                totalEl.className = 'mono text-purple-400';
            }
        }
        
        // Initialize total on page load
        document.addEventListener('DOMContentLoaded', updateTotal);
    </script>
</body>
</html>

