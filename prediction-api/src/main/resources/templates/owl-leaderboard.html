<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OWL Ratings - Tennis Prediction API</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Space Grotesk', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Sparkline SVG styles */
        .sparkline-svg {
            width: 60px;
            height: 20px;
        }
        .sparkline-line {
            fill: none;
            stroke-width: 1.5;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .sparkline-positive { stroke: #22c55e; }
        .sparkline-negative { stroke: #ef4444; }
        .sparkline-neutral { stroke: #64748b; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-950 via-indigo-950 to-slate-950 text-slate-100 min-h-screen">
    <!-- Header -->
    <header class="bg-slate-900/80 border-b border-indigo-800/50 sticky top-0 z-50 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <span class="text-2xl">ü¶â</span>
                <h1 class="text-xl font-bold bg-gradient-to-r from-amber-400 to-orange-400 bg-clip-text text-transparent">
                    OWL Rating System
                </h1>
            </div>
            <nav class="flex items-center gap-6">
                <a href="/ui/dashboard" class="text-slate-400 hover:text-slate-200 transition-colors">Dashboard</a>
                <a href="/ui/predict" class="text-slate-400 hover:text-slate-200 transition-colors">Predict</a>
                <a href="/ui/backtest" class="text-slate-400 hover:text-slate-200 transition-colors">Backtest</a>
                <a href="/ui/owl" class="text-amber-400 font-medium">Leaderboard</a>
                <a href="/ui/owl/trends" class="text-slate-400 hover:text-slate-200 transition-colors">Trends</a>
                <a href="/ui/owl/admin" class="text-slate-400 hover:text-slate-200 transition-colors">Admin</a>
            </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Title and Description -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold mb-2">ü¶â OWL Ratings Leaderboard</h2>
            <p class="text-slate-500">Odds-Weighted Ladder - A dynamic rating system that rewards upset wins and penalizes expected losses</p>
        </div>

        <!-- Stats Overview -->
        <div th:if="${stats}" class="grid md:grid-cols-5 gap-4 mb-8">
            <div class="bg-slate-900/50 border border-indigo-800/30 rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-amber-400 mono" th:text="${stats.totalPlayers}">0</div>
                <div class="text-slate-400 text-sm mt-1">Total Players</div>
            </div>
            <div class="bg-slate-900/50 border border-indigo-800/30 rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-emerald-400 mono" th:text="${stats.activePlayers}">0</div>
                <div class="text-slate-400 text-sm mt-1">Active (5+ matches)</div>
            </div>
            <div class="bg-slate-900/50 border border-indigo-800/30 rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-cyan-400 mono" th:text="${stats.avgRatingFormatted}">1500</div>
                <div class="text-slate-400 text-sm mt-1">Avg Rating</div>
            </div>
            <div class="bg-slate-900/50 border border-indigo-800/30 rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-pink-400 mono" th:text="${stats.maxRatingFormatted}">1500</div>
                <div class="text-slate-400 text-sm mt-1">Peak Rating</div>
            </div>
            <div class="bg-slate-900/50 border border-indigo-800/30 rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-slate-400 mono" th:text="${stats.minRatingFormatted}">1500</div>
                <div class="text-slate-400 text-sm mt-1">Min Rating</div>
            </div>
        </div>

        <!-- Search Box -->
        <div class="bg-slate-900/50 border border-indigo-800/30 rounded-xl p-4 mb-6">
            <form method="get" class="flex gap-4">
                <input type="text" name="search" th:value="${searchQuery}" placeholder="Search players..."
                       class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-4 py-2 focus:ring-2 focus:ring-amber-500 focus:outline-none">
                <input type="hidden" name="limit" th:value="${limit}">
                <input type="hidden" name="minMatches" th:value="${minMatches}">
                <button type="submit" class="bg-amber-600 hover:bg-amber-500 text-white font-medium rounded-lg px-6 py-2 transition-colors">
                    üîç Search
                </button>
                <a th:if="${searchQuery != null}" href="/ui/owl" 
                   class="bg-slate-700 hover:bg-slate-600 text-white font-medium rounded-lg px-4 py-2 transition-colors">
                    Clear
                </a>
            </form>
        </div>

        <!-- Leaderboard Table -->
        <div class="bg-slate-900/50 border border-indigo-800/30 rounded-xl overflow-hidden">
            <table class="w-full">
                <thead class="bg-slate-800/50 text-left text-sm text-slate-400">
                    <tr>
                        <th class="px-4 py-3 w-16">#</th>
                        <th class="px-4 py-3">Player</th>
                        <th class="px-4 py-3 text-center">OWL Rating</th>
                        <th class="px-4 py-3 text-center">ATP</th>
                        <th class="px-4 py-3 text-center">Trend</th>
                        <th class="px-4 py-3 text-center">Momentum</th>
                        <th class="px-4 py-3 text-center">W-L</th>
                        <th class="px-4 py-3 text-center">Win%</th>
                        <th class="px-4 py-3 text-center">Last 10</th>
                        <th class="px-4 py-3 w-12"></th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-800/50">
                    <tr th:each="player, stat : ${leaderboard}" 
                        class="hover:bg-slate-800/30 transition-colors">
                        <!-- Rank -->
                        <td class="px-4 py-3">
                            <span th:if="${player.owlRank <= 3}" 
                                  class="text-2xl" 
                                  th:text="${player.owlRank == 1 ? 'ü•á' : (player.owlRank == 2 ? 'ü•à' : 'ü•â')}"></span>
                            <span th:unless="${player.owlRank <= 3}" 
                                  class="text-slate-500 mono" 
                                  th:text="${player.owlRank}"></span>
                        </td>
                        <!-- Player Name -->
                        <td class="px-4 py-3">
                            <a th:href="@{/ui/owl/player/{key}(key=${player.playerKey})}"
                               class="font-medium hover:text-amber-400 transition-colors"
                               th:text="${player.playerName}">Player Name</a>
                        </td>
                        <!-- OWL Rating -->
                        <td class="px-4 py-3 text-center">
                            <span class="text-lg font-bold mono"
                                  th:classappend="${player.rating >= 1700} ? 'text-amber-400' : (${player.rating >= 1500} ? 'text-emerald-400' : 'text-slate-400')"
                                  th:text="${player.ratingFormatted}">1500</span>
                        </td>
                        <!-- ATP Rank -->
                        <td class="px-4 py-3 text-center text-slate-400 mono text-sm">
                            <span th:if="${player.atpRank != null}" th:text="${player.atpRank}">-</span>
                            <span th:unless="${player.atpRank != null}" class="text-slate-600">-</span>
                        </td>
                        <!-- Trend (Sparkline + Emoji) -->
                        <td class="px-4 py-3 text-center">
                            <div class="flex items-center justify-center gap-1">
                                <!-- Sparkline SVG generated from data -->
                                <svg th:if="${player.sparklineData != null && player.sparklineData.size() > 1}" 
                                     class="sparkline-svg" viewBox="0 0 60 20" preserveAspectRatio="none">
                                    <polyline 
                                        th:classappend="${player.momentumScore >= 10} ? 'sparkline-positive' : (${player.momentumScore <= -10} ? 'sparkline-negative' : 'sparkline-neutral')"
                                        class="sparkline-line"
                                        th:attr="points=${player.sparklinePoints}"
                                    />
                                </svg>
                                <span class="text-lg" th:text="${player.momentumEmoji}">‚û°Ô∏è</span>
                            </div>
                        </td>
                        <!-- Momentum Score -->
                        <td class="px-4 py-3 text-center">
                            <span class="mono text-sm font-medium"
                                  th:classappend="${player.momentumScore >= 10} ? 'text-green-400' : (${player.momentumScore <= -10} ? 'text-red-400' : 'text-slate-500')"
                                  th:text="${player.momentumScoreFormatted}">+0</span>
                        </td>
                        <!-- W-L -->
                        <td class="px-4 py-3 text-center mono text-sm">
                            <span class="text-emerald-400" th:text="${player.wins}">0</span>
                            <span class="text-slate-600">-</span>
                            <span class="text-red-400" th:text="${player.losses}">0</span>
                        </td>
                        <!-- Win Rate -->
                        <td class="px-4 py-3 text-center mono text-sm"
                            th:classappend="${player.winRate >= 0.6} ? 'text-emerald-400' : (${player.winRate >= 0.5} ? 'text-amber-400' : 'text-red-400')"
                            th:text="${player.winRateFormatted}">50%</td>
                        <!-- Last 10 -->
                        <td class="px-4 py-3 text-center mono text-sm"
                            th:classappend="${player.last10WinRate >= 0.7} ? 'text-emerald-400' : (${player.last10WinRate >= 0.5} ? 'text-amber-400' : 'text-red-400')"
                            th:text="${player.last10WinRateFormatted}">50%</td>
                        <!-- Arrow -->
                        <td class="px-4 py-3 text-slate-600">
                            <a th:href="@{/ui/owl/player/{key}(key=${player.playerKey})}" class="hover:text-amber-400">‚Üí</a>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <!-- Empty State -->
            <div th:if="${#lists.isEmpty(leaderboard)}" class="py-12 text-center text-slate-500">
                <p class="text-lg">No ratings found</p>
                <p class="mt-2">Initialize ratings from the <a href="/ui/owl/admin" class="text-amber-400 hover:underline">Admin page</a></p>
            </div>
        </div>

        <!-- Legend -->
        <div class="mt-8 bg-slate-900/50 border border-indigo-800/30 rounded-xl p-6">
            <h3 class="text-xl font-semibold mb-4">üìñ Column Guide</h3>
            <div class="grid md:grid-cols-3 gap-6 text-slate-400 text-sm">
                <div>
                    <h4 class="font-medium text-slate-200 mb-2">OWL vs ATP Rank</h4>
                    <ul class="space-y-1 list-disc list-inside">
                        <li>OWL = performance-based dynamic rating</li>
                        <li>ATP = official ranking points</li>
                        <li>Differences highlight form vs status</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-medium text-slate-200 mb-2">Trend & Momentum</h4>
                    <ul class="space-y-1 list-disc list-inside">
                        <li>Sparkline shows recent rating movement</li>
                        <li><span class="text-red-400">üî•</span> Hot = +30 points (last 7)</li>
                        <li><span class="text-blue-400">üßä</span> Cold = -30 points (last 7)</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-medium text-slate-200 mb-2">For Predictions</h4>
                    <ul class="space-y-1 list-disc list-inside">
                        <li>High OWL + Hot trend = strong pick</li>
                        <li>Low ATP + High OWL = undervalued</li>
                        <li>Check <a href="/ui/owl/trends" class="text-amber-400 hover:underline">Trends page</a> for more</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>
</body>
</html>
