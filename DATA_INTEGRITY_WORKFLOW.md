# Data Integrity Dashboard - User Guide

## Overview

The Data Integrity Dashboard helps ensure all tournaments in the database have complete data required for accurate predictions. It provides a workflow to export data issues, use AI tools to research missing information, and import solutions back into the system.

## Workflow Steps

### 1. Access the Dashboard

Navigate to: `http://localhost:8080/ui/data-integrity`

The dashboard displays:
- **Statistics**: Total issues, critical issues, warnings
- **Issues List**: Detailed view of all data quality problems
- **Export/Import Controls**: Tools to manage the fix workflow

### 2. Export Issues as JSON

Click the **"Export JSON"** button to download a file named `data_issues_YYYY-MM-DD.json`.

This JSON file contains:
- **Export Metadata**: Timestamp, issue counts, breakdown by severity
- **AI Instructions**: Complete instructions for any AI tool to understand the task
- **Field Definitions**: Detailed explanations of each data field
- **Validation Rules**: Rules that imported data must follow
- **Issues Array**: All detected data quality problems with context
- **Statistics**: Breakdown by issue type, impact, and entity type

### 3. Feed JSON to AI Tool

You can use any AI tool:
- **Perplexity.ai** (recommended for research tasks)
- **ChatGPT**
- **Claude**
- **Gemini**
- **Local LLMs**

#### Example Prompt for AI:

```
I have a JSON file with tennis tournament data quality issues. 
Please read the "ai_instructions" section and generate the CSV 
file as specified with researched solutions for all issues in 
the "issues" array.
```

Then paste or upload the entire JSON file.

### 4. AI Generates Solutions

The AI will research each issue and generate a CSV file with solutions.

**CSV Format:**
```csv
entity_type,entity_id,entity_name,issue_type,suggested_surface,suggested_indoor_outdoor,suggested_latitude,suggested_longitude,suggested_altitude,confidence,source
tournament,sr:tournament:1,Australian Open 2025,missing_surface,Hard,Outdoor,-37.8225,144.9784,39,high,ATP Official Website
```

**Alternative: JSON Format**

The AI can also generate JSON format:
```json
{
  "import_metadata": {
    "source": "Perplexity.ai",
    "generated_date": "2025-11-16T14:30:00Z"
  },
  "solutions": [
    {
      "entity_type": "tournament",
      "entity_id": "sr:tournament:1",
      "entity_name": "Australian Open 2025",
      "issue_type": "missing_surface",
      "solution": {
        "surface": "Hard",
        "indoor_outdoor": "Outdoor",
        "latitude": "-37.8225",
        "longitude": "144.9784",
        "altitude": "39",
        "confidence": "high",
        "source": "ATP Official Website"
      }
    }
  ]
}
```

### 5. Import Solutions

Back in the Data Integrity Dashboard:

1. Click **"Choose File"** under "Import Solutions"
2. Select the CSV or JSON file generated by the AI
3. Click **"Upload & Preview"**

The system will:
- Parse the file
- Validate all data against rules
- Display any validation errors
- Show a preview table of all solutions

### 6. Review Preview

The preview table shows:
- Entity name and type
- Issue type being fixed
- Suggested values (surface, indoor/outdoor, coordinates, altitude)
- Confidence level (high/medium/low)
- Data source

Review the data carefully to ensure accuracy.

### 7. Apply Solutions

If everything looks correct, click **"Apply All Solutions to Database"**.

The system will:
- Apply each solution to the database
- Update tournament and venue records
- Report success/failure counts
- Show any errors that occurred

### 8. Verify

After applying solutions:
- The dashboard will refresh
- Issue counts should decrease
- Fixed issues will no longer appear in the list
- You can export again to see remaining issues

## Data Fields Explained

### Surface Types
- **Hard**: Most common, used in Australian Open, US Open
- **Clay**: French Open, many European tournaments
- **Grass**: Wimbledon, few other tournaments
- **Carpet**: Rare, mostly indoor events

### Indoor/Outdoor
- **Outdoor**: Most tournaments
- **Indoor**: Arena events, typically in winter months
- **Note**: Stadiums with retractable roofs are classified by primary configuration

### Coordinates
- **Latitude**: -90 to 90 (negative = south, positive = north)
- **Longitude**: -180 to 180 (negative = west, positive = east)
- **Format**: Decimal degrees (e.g., -37.8225, not DMS format)

### Altitude
- **Units**: Meters above sea level
- **Range**: Typically -500 to 9000 meters
- **Impact**: High altitude (>1000m) significantly affects ball speed
- **Examples**: 
  - Sea level venues: 0-50m
  - Mexico City: ~2,240m
  - Bogot√°: ~2,640m

### Confidence Levels
- **High**: Data from official sources (ATP/WTA, tournament websites)
- **Medium**: Data from reliable secondary sources (Wikipedia, sports databases)
- **Low**: Data inferred or from less reliable sources

## Validation Rules

The import system validates:

1. **Surface**: Must be one of: Hard, Clay, Grass, Carpet
2. **Indoor/Outdoor**: Must be either Indoor or Outdoor
3. **Latitude**: Must be between -90 and 90
4. **Longitude**: Must be between -180 and 180
5. **Altitude**: Must be between -500 and 9000 meters
6. **Confidence**: Must be one of: high, medium, low
7. **Entity ID**: Must match an existing tournament in the database

Invalid data will be flagged during preview and won't be applied.

## Issue Types

### Critical Issues
These significantly impact prediction accuracy:
- **missing_surface**: Tournament surface type unknown (20% prediction weight)
- **missing_indoor_outdoor**: Indoor/outdoor classification unknown (15% prediction weight)

### Warning Issues
These have moderate impact:
- **missing_coordinates**: Venue latitude/longitude unknown (needed for altitude lookup)
- **missing_altitude**: Venue elevation unknown (affects speed calculation)

## Tips for Best Results

1. **Use Official Sources**: ATP/WTA websites are most reliable
2. **Cross-Reference**: Verify data from multiple sources when possible
3. **Check Recent Data**: Tournaments may change venues or surfaces
4. **Grand Slams**: These are well-documented and good confidence checks
5. **Historical Context**: Some tournaments have moved or changed surfaces over time
6. **Retractable Roofs**: Check tournament rules for classification
7. **Altitude Matters**: Don't skip this - it affects prediction accuracy significantly

## Example Workflow

```bash
# 1. Export issues
Visit: http://localhost:8080/ui/data-integrity
Click: "Export JSON"
Download: data_issues_2025-11-16.json

# 2. Use AI (Perplexity.ai example)
Prompt: "Please research and fill in the missing data for these tennis tournaments"
Upload: data_issues_2025-11-16.json
Receive: tennis_data_solutions.csv

# 3. Import solutions
Visit: http://localhost:8080/ui/data-integrity
Upload: tennis_data_solutions.csv
Review: Preview table
Click: "Apply All Solutions to Database"

# 4. Verify
Check: Issue count decreased
Export: Again to see remaining issues
Repeat: Until all critical issues resolved
```

## Troubleshooting

### "No valid solutions found in file"
- Check CSV format matches expected columns
- Ensure no extra spaces or special characters
- Verify file encoding is UTF-8

### "Validation errors"
- Review the validation warnings list
- Check that values match allowed options
- Verify numeric fields are valid numbers
- Ensure coordinates are in decimal degrees format

### "Preview session expired"
- Re-upload the file
- Don't wait too long between preview and apply
- Preview data is cached temporarily

### "Failed to apply solution"
- Check that tournament/venue still exists in database
- Verify entity_id matches database records
- Review apply errors list for specific issues

## API Endpoints

For programmatic access:

- **Dashboard**: `GET /ui/data-integrity`
- **Export**: `GET /ui/data-integrity/export`
- **Import**: `POST /ui/data-integrity/import` (multipart/form-data)
- **Apply**: `POST /ui/data-integrity/apply` (form data with previewId)

## Security Notes

- Only upload files from trusted sources
- Review all data before applying
- The system validates all inputs
- Changes are applied transactionally
- Failed updates don't affect successful ones

## Support

For issues or questions:
1. Check validation error messages
2. Review this guide
3. Verify data format matches examples
4. Check application logs for detailed errors

